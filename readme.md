# ðŸª£ emmer
[![Go Report Card](https://goreportcard.com/badge/github.com/TimoKats/emmer)](https://goreportcard.com/report/github.com/TimoKats/emmer)
[![Tests](https://github.com/TimoKats/emmer/actions/workflows/test.yaml/badge.svg)](https://github.com/TimoKats/emmer/actions/workflows/test.yaml)
[![License: EUPL](https://img.shields.io/badge/license-EUPL-blue.svg)](https://joinup.ec.europa.eu/collection/eupl/eupl-text-eupl-12)

Self-hosted API for CRUD-ing JSON data on different filesystems (local, S3, azure blob, ...). Built for data storage in small personal projects, or mocking an API for development. Advantages are simplicity, interoperabillity (JSON files, APIs, multiple filesystems) and performance (using the cache system).   

You can install emmer with the command below. After that, you can run `emmer` to start.

```console
foo@bar:~$ go install github.com/TimoKats/emmer@latest
foo@bar:~$ emmer
2025/09/10 16:41:20 set username to: admin
2025/09/10 16:41:20 set password to: ************
2025/09/10 16:41:20 selected local fs in: /home/user/.emmer
2025/09/10 16:41:20 server is running on http://localhost:8080
```

The API is based on your JSON structure. So the example below is for CRUD-ing `[key1][key2]` in `file.json`. The value (which can be anything) is then added to the body of the request. Moreover, there are helper functions for appending and incrementing values. 

```
DELETE/PUT/GET: /api/file/key1/key2/...
```

<details>
<summary>Examples</summary>
<hr />

In this example, we will use emmer to create a small database for blogs and comments. Note, username/password for (required) basic auth is generated on startup, or set environment variables.

1: Do a PUT request to <code>/api/posts</code> with body shown below to create a json file we can start with.

```json
{
  "article1": {"text": "Here I write my article"}
}
```

2: Query your json file with GET requests. For example, sending a GET request to <code>/api/posts/article1/text</code> will return the text field of post1.

```json
"Here I write my article"
```

3: Continously add comments to our posts. This would probably be a list of "comment" objects. Emmer handles this by adding the "append" parameter to our PUT request. For example, the comment (shown below) is sent to <code>/api/posts/article1/comments?mode=append</code>.

```json
{"comment": "great stuff", "username": "timo"}
```

4: Do a GET request to <code>/api/posts/article1/comments</code>/ to fetch all comments. Note, you can do the PUT request from step 3 again to keep adding comments to your article.

```json
[{"comment": "great stuff", "username": "timo"}]
```

5: Send a DELETE request to <code>/api/posts</code> to delete the json file. This complete json file should look (something) like this:

```json
{
    "post1": {
        "comments": [{"comment": "not great stuff", "username": "tomi"}, {"comment": "great stuff", "username": "timo"}],
        "text": "Here I write my article"
    }
}

```

<hr />
</details>

<details>
<summary>Docs</summary>
<hr />

<b>Endpoints</b>
 - /api/\<json file\>/\<json path\>/...: PUT/DEL/GET requests to edit your json data. Body contains value, URL path contains key. Note, first object in URL path is the filename. However, if you add '--' characters you can also utilize folder paths for all connectors.
 - /logs: Shows last _n_ logs generated by emmer
 - /ping: Health check of emmer. Bypasses authentication.
 - /commit: Write current cache to filesystem.

<b>Parameters</b>
- mode: increment. With PUT requests, if you access a numeric value, adding increment parameter will increase it by 1. Note, if you put a numeric value in your body (-1, 2, etc) then that's added to the numeric value instead.
- mode: append. With PUT requests, you can append objects (that you put in your request body) to a json list. Note, if the json key doesn't exist (or is not a list), this mode will do that conversion automatically.
- mode: fs. With GET requests, you can use fs to force reading from the filesystem (and not cache).

<b>Environment variables</b>
- EM_AUTOTABLE: Set to false if you DON'T want to automatically create a new file when adding an entry.
- EM_USERNAME: Username of basic auth for API. Auto generated if empty.
- EM_PASSWORD: Password of basic auth for API. Auto generated if empty
- EM_CONNECTOR: Local, S3, etc.
- EM_FOLDER: When using local FS, this sets the folder emmer writes files to. Default: $HOME/.local/share/emmer (or XDG_DATA_HOME) (AppData on Windows).
- EM_COMMIT: Optional numeric value. Impacts how often you write your cache to the filesystem. E.g. an EM_COMMIT of 5 writes to the filesystem every 5th change (other changes are just written to cache). Default is 1.

<b>Flags</b>
- -p: sets the port to run on. Default is 8080.

<b>Connectors</b>  
As mentioned in the environment variables section, you can select a connector by changing the EM_CONNECTOR value.
- Local: Stores files on your local device. You can still select the folder using EM_FOLDER.
- S3: [in progress] Stores files in AWS S3 buckets.

<hr />
</details>


<details>
<summary>Connectors</summary>
<hr />
  
As mentioned in the environment variables section, you can select a connector by changing the EM_CONNECTOR value.  
- Local: Stores files on your local device. You can still select the folder using EM_FOLDER.
- S3: Stores files in AWS S3 buckets. Requires AWS access keys (AWS_SECRET_ACCESS_KEY, AWS_ACCESS_KEY_ID AWS_SESSION_TOKEN) to be set. EM_S3_BUCKET env variable contains the S3 bucket name for file operations.
<hr />
</details>

